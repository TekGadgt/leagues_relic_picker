<!DOCTYPE html>
<html lang="en">

<head>
  <title>Demonic Pacts Pact Picker</title>
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://relics.runetools.lol/osrs/6/pacts.html" />
  <meta property="og:title" content="Demonic Pacts Pact Picker" />
  <meta property="og:description" content="Set a title, pick your pacts, screenshot and share" />
  <meta property="og:image" content="https://relics.runetools.lol/osrs/6/poster_pacts.png" />
  <meta propery="og:image:alt" content="A Selection of Pacts for the OSRS Demonic Pacts League." />
  <link rel="stylesheet" href="./variables.css" />
  <link rel="stylesheet" href="../../styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="../../shared.js"></script>
</head>

<body>
  <nav class="navbar">
    <a href="../../index.html" class="nav-link">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
      </svg>
      Back to Home
    </a>
    <a href="https://github.com/TekGadgt/leagues_relic_picker" target="_blank" class="nav-link github-link">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
      </svg>
    </a>
  </nav>
  <main id="main">
    <h1 class="title" contenteditable="true">Change Me</h1>
    <div class="rowContainer" id="pactsContainer">
      <!-- Pacts will be dynamically inserted here -->
    </div>
  </main>
  <button id="exportBtn">Export Image</button>
  <script>
    async function fetchPacts() {
      try {
        const response = await fetch('./pacts.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const pactsData = await response.json();
        return pactsData.pacts;
      } catch (error) {
        console.error('Error fetching pacts:', error);
      }
    }

    function createPactElement(pact, type) {
      const pactDiv = document.createElement('div');
      pactDiv.className = 'mastery';
      pactDiv.id = `${type}-${pact.id}`;

      const img = document.createElement('img');
      img.className = 'masteryImg';
      img.src = pact.src;
      img.alt = `${pact.title} pact icon`;
      pactDiv.appendChild(img);

      const span = document.createElement('span');
      span.className = 'masteryLabel';
      span.textContent = pact.title;
      pactDiv.appendChild(span);

      // Create tooltip if toolTipItems exist
      if (pact.toolTipItems && pact.toolTipItems.length > 0) {
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';

        const list = document.createElement('ul');
        pact.toolTipItems.forEach(item => {
          const listItem = document.createElement('li');
          listItem.textContent = item;
          list.appendChild(listItem);
        });

        tooltip.appendChild(list);
        pactDiv.appendChild(tooltip);
      }

      return pactDiv;
    }

    function renderPacts(pacts) {
      const container = document.getElementById('pactsContainer');
      Object.keys(pacts).forEach(type => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'row';
        rowDiv.id = type;

        pacts[type].forEach(pact => {
          const pactElement = createPactElement(pact, type);
          rowDiv.appendChild(pactElement);
        });

        container.appendChild(rowDiv);
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const pacts = await fetchPacts();
      renderPacts(pacts);
      setInitialSelections(document.getElementsByClassName('mastery'), '.title');
      Array.from(document.getElementsByClassName('mastery')).forEach(pact => pact.addEventListener('click', function () {
        toggleElement(this, document.getElementsByClassName('mastery'), '.title');
      }));
    });

    document.querySelector('.title').addEventListener('input', function () {
      updateURLParams(document.getElementsByClassName('mastery'), '.title');
    });

    document.getElementById('exportBtn').addEventListener('click', function () {
      var mainElement = document.getElementById('main');

      // Hide all tooltips before export
      const tooltips = document.querySelectorAll('.tooltip');
      tooltips.forEach(tooltip => {
        tooltip.style.display = 'none';
      });

      mainElement.style.backgroundColor = '#0B0000';
      mainElement.style.paddingTop = '50px';
      mainElement.style.paddingBottom = '50px';
      html2canvas(mainElement, {
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#0B0000'
      }).then(function (canvas) {
        var link = document.createElement('a');
        link.download = 'pacts.png';
        link.href = canvas.toDataURL();
        link.click();

        // Show tooltips again after export
        tooltips.forEach(tooltip => {
          tooltip.style.display = '';
        });
      });
    });
  </script>
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
    data-cf-beacon='{"token": "a488248dbb94443d840feb6ed005bc1b"}'></script>
</body>

</html>
